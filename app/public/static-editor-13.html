<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Static Editor - Page 13 | CrewArmy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            900: '#0f172a',
                            800: '#1e293b',
                            700: '#334155',
                            600: '#475569',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
        }
    </style>
</head>
<body class="text-white">
    <div class="min-h-screen p-4">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="flex justify-between items-center mb-8">
                <div class="flex items-center gap-4">
                    <h1 class="text-3xl font-bold">üåê Static Editor - Page 13</h1>
                </div>
                <div class="flex gap-4">
                    <button onclick="saveContent()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded flex items-center gap-2">
                        üíæ Save & Push
                    </button>
                    <a href="https://multinat.github.io/CrewArmy/pages/13/" target="_blank" 
                       class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded flex items-center gap-2">
                        üëÅÔ∏è Preview
                    </a>
                </div>
            </div>

            <!-- Status Alert -->
            <div id="statusAlert" class="mb-6 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg hidden">
                <div id="statusMessage" class="text-blue-400"></div>
            </div>

            <!-- Token Input - Only shown when no token -->
            <div id="tokenSection" class="mb-6 p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                <h3 class="text-yellow-400 font-bold mb-2">üîë Enter Token</h3>
                <div class="flex gap-3 items-end">
                    <input type="password" id="githubToken" placeholder="Paste access token here..." 
                           class="flex-1 bg-slate-800 border border-slate-600 rounded px-3 py-2 text-white">
                    <button onclick="setTokenAndLoad()" 
                            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-semibold">
                        Load
                    </button>
                </div>
            </div>
            
            <!-- Content Loaded Section - Hidden initially -->
            <div id="contentSection" class="mb-6 p-4 bg-green-500/10 border border-green-500/30 rounded-lg hidden">
                <div class="flex justify-between items-center">
                    <h3 class="text-green-400 font-bold">‚úÖ Ready to Edit</h3>
                    <button onclick="resetToken()" 
                            class="text-gray-400 hover:text-gray-300 text-sm underline">
                        Change Token
                    </button>
                </div>
            </div>


            <!-- Editor Interface - Matches Page 13 Layout -->
            
            <!-- PRIMARY ROLES Section -->
            <div class="mb-8">
                <div class="mb-6">
                    <h2 class="text-xl font-bold text-blue-400 mb-4 flex items-center gap-2">
                        üéØ PRIMARY ROLES: Bottlewasher Operations
                    </h2>
                    
                    <!-- Row 1: Safety & Quality -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6">
                        <!-- Safety Section -->
                        <div class="bg-gray-800/60 rounded-xl p-6 border-l-4 border-yellow-400">
                            <div class="flex items-center gap-3 mb-4">
                                <span class="text-2xl">üõ°Ô∏è</span>
                                <h3 class="text-lg font-bold text-yellow-400">SAFETY FIRST</h3>
                            </div>
                            <div id="safetyItems" class="space-y-3">
                                <!-- Safety items will be loaded here -->
                            </div>
                            <button onclick="addItem('safety')" class="mt-3 text-yellow-400 hover:text-yellow-300 flex items-center gap-1.5 text-sm">
                                ‚ûï Add Safety Item
                            </button>
                        </div>

                        <!-- Quality Section -->
                        <div class="bg-gray-800/60 rounded-xl p-6 border-l-4 border-green-400">
                            <div class="flex items-center gap-3 mb-4">
                                <span class="text-2xl">‚úÖ</span>
                                <h3 class="text-lg font-bold text-green-400">QUALITY ALWAYS</h3>
                            </div>
                            <div id="qualityItems" class="space-y-3">
                                <!-- Quality items will be loaded here -->
                            </div>
                            <button onclick="addItem('quality')" class="mt-3 text-green-400 hover:text-green-300 flex items-center gap-1.5 text-sm">
                                ‚ûï Add Quality Item
                            </button>
                        </div>
                    </div>

                    <!-- Row 2: Volume & Cost -->
                    <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                        <!-- Volume Section -->
                        <div class="bg-gray-800/60 rounded-xl p-6 border-l-4 border-orange-400">
                            <div class="flex items-center gap-3 mb-4">
                                <span class="text-2xl">üìä</span>
                                <h3 class="text-lg font-bold text-orange-400">VOLUME</h3>
                            </div>
                            <div id="volumeItems" class="space-y-3">
                                <!-- Volume items will be loaded here -->
                            </div>
                            <button onclick="addItem('volume')" class="mt-3 text-orange-400 hover:text-orange-300 flex items-center gap-1.5 text-sm">
                                ‚ûï Add Volume Item
                            </button>
                        </div>

                        <!-- Cost Section -->
                        <div class="bg-gray-800/60 rounded-xl p-6 border-l-4 border-purple-400">
                            <div class="flex items-center gap-3 mb-4">
                                <span class="text-2xl">üí∞</span>
                                <h3 class="text-lg font-bold text-purple-400">COST</h3>
                            </div>
                            <div id="costItems" class="space-y-3">
                                <!-- Cost items will be loaded here -->
                            </div>
                            <button onclick="addItem('cost')" class="mt-3 text-purple-400 hover:text-purple-300 flex items-center gap-1.5 text-sm">
                                ‚ûï Add Cost Item
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SECONDARY/SUPPORT ROLES Section -->
            <div class="mb-8">
                <h2 class="text-xl font-bold text-amber-400 mb-6 flex items-center gap-2">
                    üë• SECONDARY/SUPPORT ROLES: Labeller & Infeed Support
                </h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                    <!-- Labeller Support -->
                    <div class="bg-gray-700/50 rounded-xl p-6 border-l-4 border-amber-400">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">üè∑Ô∏è</span>
                            <h3 class="text-base font-bold text-amber-400">LABELLER SUPPORT</h3>
                        </div>
                        <div id="labellerItems" class="space-y-3">
                            <!-- Labeller items will be loaded here -->
                        </div>
                        <button onclick="addItem('labeller')" class="mt-3 text-amber-400 hover:text-amber-300 flex items-center gap-1.5 text-sm">
                            ‚ûï Add Labeller Item
                        </button>
                    </div>

                    <!-- Infeed Coordination -->
                    <div class="bg-gray-700/50 rounded-xl p-6 border-l-4 border-teal-400">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">üîÑ</span>
                            <h3 class="text-base font-bold text-teal-400">INFEED COORDINATION</h3>
                        </div>
                        <div id="infeedItems" class="space-y-3">
                            <!-- Infeed items will be loaded here -->
                        </div>
                        <button onclick="addItem('infeed')" class="mt-3 text-teal-400 hover:text-teal-300 flex items-center gap-1.5 text-sm">
                            ‚ûï Add Infeed Item
                        </button>
                    </div>

                    <!-- Team Leadership -->
                    <div class="bg-gray-700/50 rounded-xl p-6 border-l-4 border-cyan-400">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">üë®‚Äçüíº</span>
                            <h3 class="text-base font-bold text-cyan-400">TEAM LEADERSHIP</h3>
                        </div>
                        <div id="teamItems" class="space-y-3">
                            <!-- Team items will be loaded here -->
                        </div>
                        <button onclick="addItem('team')" class="mt-3 text-cyan-400 hover:text-cyan-300 flex items-center gap-1.5 text-sm">
                            ‚ûï Add Leadership Item
                        </button>
                    </div>
                </div>
            </div>

            <!-- Instructions -->
            <div class="mt-8 p-6 bg-gray-800/30 rounded-xl">
                <h3 class="text-xl font-bold text-blue-400 mb-4">üìã How to Use</h3>
                <ol class="list-decimal list-inside space-y-2 text-gray-300">
                    <li>Enter your token and click "Load"</li>
                    <li>Edit text in any section below</li>
                    <li>Add new items with ‚ûï buttons</li>
                    <li>Click "Save & Push" to update</li>
                    <li>View changes on live site (5-10 minutes)</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        let currentContent = null;
        let savedToken = null;

        function showStatus(message, type = 'info') {
            const alert = document.getElementById('statusAlert');
            const messageEl = document.getElementById('statusMessage');
            messageEl.textContent = message;
            
            alert.classList.remove('hidden', 'bg-blue-500/10', 'border-blue-500/30', 'bg-green-500/10', 'border-green-500/30', 'bg-red-500/10', 'border-red-500/30');
            messageEl.classList.remove('text-blue-400', 'text-green-400', 'text-red-400');
            
            if (type === 'success') {
                alert.classList.add('bg-green-500/10', 'border-green-500/30');
                messageEl.classList.add('text-green-400');
            } else if (type === 'error') {
                alert.classList.add('bg-red-500/10', 'border-red-500/30');
                messageEl.classList.add('text-red-400');
            } else {
                alert.classList.add('bg-blue-500/10', 'border-blue-500/30');
                messageEl.classList.add('text-blue-400');
            }
            
            alert.classList.remove('hidden');
            
            setTimeout(() => {
                alert.classList.add('hidden');
            }, 5000);
        }

        function setTokenAndLoad() {
            const token = document.getElementById('githubToken').value.trim();
            if (!token) {
                showStatus('Please enter a token first!', 'error');
                return;
            }
            
            savedToken = token;
            localStorage.setItem('editorToken', token);
            
            // Hide token section, show content section
            document.getElementById('tokenSection').classList.add('hidden');
            document.getElementById('contentSection').classList.remove('hidden');
            
            loadContent();
        }
        
        function resetToken() {
            savedToken = null;
            localStorage.removeItem('editorToken');
            document.getElementById('githubToken').value = '';
            document.getElementById('tokenSection').classList.remove('hidden');
            document.getElementById('contentSection').classList.add('hidden');
            currentContent = null;
            
            // Clear editor content
            ['safetyItems', 'qualityItems', 'volumeItems', 'costItems', 'labellerItems', 'infeedItems', 'teamItems'].forEach(id => {
                const element = document.getElementById(id);
                if (element) element.innerHTML = '';
            });
        }
        
        // Check for saved token on page load
        window.addEventListener('load', function() {
            const savedTokenFromStorage = localStorage.getItem('editorToken');
            if (savedTokenFromStorage) {
                savedToken = savedTokenFromStorage;
                document.getElementById('githubToken').value = savedTokenFromStorage;
                setTokenAndLoad();
            }
        });

        async function loadContent() {
            const token = savedToken || document.getElementById('githubToken').value;
            if (!token) {
                showStatus('Please enter your token first!', 'error');
                return;
            }

            showStatus('Loading content...');
            
            try {
                const response = await fetch('https://api.github.com/repos/Multinat/CrewArmy/contents/app/lib/slide-content.json', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                const content = JSON.parse(atob(data.content));
                currentContent = content;

                // Populate the editor with content
                populateEditor(content.slide13);
                showStatus('‚úÖ Content loaded successfully!', 'success');
                
            } catch (error) {
                showStatus(`Error loading content: ${error.message}`, 'error');
            }
        }

        function populateEditor(slide13) {
            // Populate Primary Roles (same order as mobile layout)
            populateSection('safetyItems', slide13.primaryRoles.safety.items, 'safety');
            populateSection('qualityItems', slide13.primaryRoles.quality.items, 'quality');
            populateSection('volumeItems', slide13.primaryRoles.volume.items, 'volume');
            populateSection('costItems', slide13.primaryRoles.cost.items, 'cost');
            
            // Populate Secondary Roles 
            populateSection('labellerItems', slide13.secondaryRoles.labellerSupport.items, 'labeller');
            populateSection('infeedItems', slide13.secondaryRoles.infeedCoordination.items, 'infeed');
            populateSection('teamItems', slide13.secondaryRoles.teamLeadership.items, 'team');
        }

        function populateSection(containerId, items, section) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            items.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'flex items-start gap-2';
                div.innerHTML = `
                    <div class="w-2 h-2 bg-current rounded-full mt-2 opacity-60"></div>
                    <textarea 
                           onchange="updateItem('${section}', ${index}, this.value)"
                           oninput="autoResize(this)"
                           class="flex-1 bg-slate-700 border border-slate-600 rounded px-2 py-1.5 text-white text-xs leading-tight resize-none overflow-hidden"
                           rows="1"
                           style="min-height: 24px; line-height: 1.2;"
                           placeholder="Enter item...">${item}</textarea>
                    <button onclick="removeItem('${section}', ${index})" 
                            class="text-red-400 hover:text-red-300 px-1.5 py-1 rounded text-xs"
                            title="Remove item">üóëÔ∏è</button>
                `;
                container.appendChild(div);
            });
        }

        function updateItem(section, index, value) {
            if (!currentContent) return;
            
            // Handle primary roles
            if (['safety', 'quality', 'volume', 'cost'].includes(section)) {
                currentContent.slide13.primaryRoles[section].items[index] = value;
            }
            // Handle secondary roles
            else if (section === 'labeller') {
                currentContent.slide13.secondaryRoles.labellerSupport.items[index] = value;
            }
            else if (section === 'infeed') {
                currentContent.slide13.secondaryRoles.infeedCoordination.items[index] = value;
            }
            else if (section === 'team') {
                currentContent.slide13.secondaryRoles.teamLeadership.items[index] = value;
            }
        }

        function addItem(section) {
            if (!currentContent) {
                showStatus('Please load content first!', 'error');
                return;
            }
            
            // Handle primary roles
            if (['safety', 'quality', 'volume', 'cost'].includes(section)) {
                currentContent.slide13.primaryRoles[section].items.push('New item');
            }
            // Handle secondary roles
            else if (section === 'labeller') {
                currentContent.slide13.secondaryRoles.labellerSupport.items.push('New labeller task');
            }
            else if (section === 'infeed') {
                currentContent.slide13.secondaryRoles.infeedCoordination.items.push('New infeed task');
            }
            else if (section === 'team') {
                currentContent.slide13.secondaryRoles.teamLeadership.items.push('New leadership task');
            }
            
            populateEditor(currentContent.slide13);
        }

        function removeItem(section, index) {
            if (!currentContent) return;
            
            // Handle primary roles
            if (['safety', 'quality', 'volume', 'cost'].includes(section)) {
                currentContent.slide13.primaryRoles[section].items.splice(index, 1);
            }
            // Handle secondary roles
            else if (section === 'labeller') {
                currentContent.slide13.secondaryRoles.labellerSupport.items.splice(index, 1);
            }
            else if (section === 'infeed') {
                currentContent.slide13.secondaryRoles.infeedCoordination.items.splice(index, 1);
            }
            else if (section === 'team') {
                currentContent.slide13.secondaryRoles.teamLeadership.items.splice(index, 1);
            }
            
            populateEditor(currentContent.slide13);
        }

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.max(24, textarea.scrollHeight) + 'px';
        }

        async function saveContent() {
            const token = savedToken || document.getElementById('githubToken').value;
            if (!token || !currentContent) {
                showStatus('Please enter token and load content first!', 'error');
                return;
            }

            showStatus('Saving and pushing changes...');

            try {
                // Get current file to get its SHA
                const getResponse = await fetch('https://api.github.com/repos/Multinat/CrewArmy/contents/app/lib/slide-content.json', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                const currentFile = await getResponse.json();
                
                // Update the file
                const updateResponse = await fetch('https://api.github.com/repos/Multinat/CrewArmy/contents/app/lib/slide-content.json', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Update Page 13 content via static editor\n\n- Updated via static editor\n- Timestamp: ${new Date().toISOString()}`,
                        content: btoa(JSON.stringify(currentContent, null, 2)),
                        sha: currentFile.sha
                    })
                });

                if (updateResponse.ok) {
                    showStatus('‚úÖ Content saved and pushed successfully!', 'success');
                } else {
                    throw new Error(`Failed to update: ${updateResponse.status}`);
                }

            } catch (error) {
                showStatus(`Error saving: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
