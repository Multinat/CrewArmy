<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Static Editor - Page 2 | CrewArmy</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        slate: {
                            900: '#0f172a',
                            800: '#1e293b',
                            700: '#334155',
                            600: '#475569',
                        }
                    }
                }
            }
        }
    </script>
    <style>
        body {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
        }
    </style>
</head>
<body class="text-white">
    <div class="min-h-screen p-4">
        <div class="max-w-7xl mx-auto">
            <!-- Header -->
            <div class="flex justify-between items-center mb-8">
                <div class="flex items-center gap-4">
                    <h1 class="text-3xl font-bold">üåê Static Editor - Page 2</h1>
                </div>
                <div class="flex gap-4">
                    <button onclick="saveContent()" class="bg-green-600 hover:bg-green-700 px-4 py-2 rounded flex items-center gap-2">
                        üíæ Save & Push
                    </button>
                    <a href="https://multinat.github.io/CrewArmy/pages/2/" target="_blank" 
                       class="bg-purple-600 hover:bg-purple-700 px-4 py-2 rounded flex items-center gap-2">
                        üëÅÔ∏è Preview
                    </a>
                </div>
            </div>

            <!-- Status Alert -->
            <div id="statusAlert" class="mb-6 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg hidden">
                <div id="statusMessage" class="text-blue-400"></div>
            </div>

            <!-- Token Input - Only shown when no token -->
            <div id="tokenSection" class="mb-6 p-4 bg-yellow-500/10 border border-yellow-500/30 rounded-lg">
                <h3 class="text-yellow-400 font-bold mb-2">üîë Enter Token</h3>
                <div class="flex gap-3 items-end">
                    <input type="password" id="githubToken" placeholder="Paste access token here..." 
                           class="flex-1 bg-slate-800 border border-slate-600 rounded px-3 py-2 text-white">
                    <button onclick="setTokenAndLoad()" 
                            class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded font-semibold">
                        Load
                    </button>
                </div>
            </div>
            
            <!-- Content Loaded Section - Hidden initially -->
            <div id="contentSection" class="mb-6 p-4 bg-green-500/10 border border-green-500/30 rounded-lg hidden">
                <div class="flex justify-between items-center">
                    <h3 class="text-green-400 font-bold">‚úÖ Ready to Edit</h3>
                    <button onclick="resetToken()" 
                            class="text-gray-400 hover:text-gray-300 text-sm underline">
                        Change Token
                    </button>
                </div>
            </div>

            <!-- Page Title Editor -->
            <div class="mb-8 p-6 bg-gray-800/60 rounded-xl border-l-4 border-blue-400">
                <div class="flex items-center gap-3 mb-4">
                    <span class="text-2xl">üìÑ</span>
                    <h2 class="text-xl font-bold text-blue-400">PAGE TITLE</h2>
                </div>
                <textarea 
                    id="pageTitle"
                    onchange="updatePageTitle(this.value)"
                    oninput="autoResize(this)"
                    class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white text-lg font-bold leading-tight resize-none overflow-hidden"
                    rows="1"
                    style="min-height: 40px; line-height: 1.2;"
                    placeholder="Enter page title..."></textarea>
            </div>

            <!-- Page Subtitle Editor -->
            <div class="mb-8 p-6 bg-gray-800/60 rounded-xl border-l-4 border-gray-400">
                <div class="flex items-center gap-3 mb-4">
                    <span class="text-2xl">üìù</span>
                    <h2 class="text-xl font-bold text-gray-400">PAGE SUBTITLE</h2>
                </div>
                <textarea 
                    id="pageSubtitle"
                    onchange="updatePageSubtitle(this.value)"
                    oninput="autoResize(this)"
                    class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white text-base leading-tight resize-none overflow-hidden"
                    rows="1"
                    style="min-height: 32px; line-height: 1.2;"
                    placeholder="Enter page subtitle..."></textarea>
            </div>

            <!-- VPO Wheel Section -->
            <div class="mb-8">
                <h2 class="text-xl font-bold text-blue-400 mb-6 flex items-center gap-2">
                    üéØ VPO WHEEL
                </h2>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <!-- Center Text -->
                    <div class="bg-gray-800/60 rounded-xl p-6 border-l-4 border-blue-400">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">‚≠ï</span>
                            <h3 class="text-lg font-bold text-blue-400">CENTER TEXT</h3>
                        </div>
                        <input type="text" id="centerText" onchange="updateVPOWheel('centerText', this.value)"
                               class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white mb-3"
                               placeholder="Center text...">
                        <input type="text" id="centerSubtext" onchange="updateVPOWheel('centerSubtext', this.value)"
                               class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white"
                               placeholder="Center subtext...">
                    </div>

                    <!-- Safety -->
                    <div class="bg-gray-800/60 rounded-xl p-6 border-l-4 border-yellow-400">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">üõ°Ô∏è</span>
                            <h3 class="text-lg font-bold text-yellow-400">SAFETY</h3>
                        </div>
                        <input type="text" id="safetyTitle" onchange="updateVPOWheel('safety.title', this.value)"
                               class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white mb-3"
                               placeholder="Safety title...">
                        <input type="text" id="safetySubtitle" onchange="updateVPOWheel('safety.subtitle', this.value)"
                               class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white"
                               placeholder="Safety subtitle...">
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mt-6">
                    <!-- Quality -->
                    <div class="bg-gray-800/60 rounded-xl p-6 border-l-4 border-green-400">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">‚úÖ</span>
                            <h3 class="text-lg font-bold text-green-400">QUALITY</h3>
                        </div>
                        <input type="text" id="qualityTitle" onchange="updateVPOWheel('quality.title', this.value)"
                               class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white mb-3"
                               placeholder="Quality title...">
                        <input type="text" id="qualitySubtitle" onchange="updateVPOWheel('quality.subtitle', this.value)"
                               class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white"
                               placeholder="Quality subtitle...">
                    </div>

                    <!-- Volume -->
                    <div class="bg-gray-800/60 rounded-xl p-6 border-l-4 border-orange-400">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">üìä</span>
                            <h3 class="text-lg font-bold text-orange-400">VOLUME</h3>
                        </div>
                        <input type="text" id="volumeTitle" onchange="updateVPOWheel('volume.title', this.value)"
                               class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white mb-3"
                               placeholder="Volume title...">
                        <input type="text" id="volumeSubtitle" onchange="updateVPOWheel('volume.subtitle', this.value)"
                               class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white"
                               placeholder="Volume subtitle...">
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-1 gap-6 mt-6">
                    <!-- Cost -->
                    <div class="bg-gray-800/60 rounded-xl p-6 border-l-4 border-purple-400">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">üí∞</span>
                            <h3 class="text-lg font-bold text-purple-400">COST</h3>
                        </div>
                        <input type="text" id="costTitle" onchange="updateVPOWheel('cost.title', this.value)"
                               class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white mb-3"
                               placeholder="Cost title...">
                        <input type="text" id="costSubtitle" onchange="updateVPOWheel('cost.subtitle', this.value)"
                               class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white"
                               placeholder="Cost subtitle...">
                    </div>
                </div>
            </div>

            <!-- Autonomous Team Section -->
            <div class="mb-8">
                <h2 class="text-xl font-bold text-amber-400 mb-6 flex items-center gap-2">
                    üë• AUTONOMOUS TEAM APPROACH
                </h2>
                
                <div class="grid grid-cols-1 gap-6">
                    <!-- Team Title -->
                    <div class="bg-gray-700/50 rounded-xl p-6 border-l-4 border-amber-400">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">üéØ</span>
                            <h3 class="text-base font-bold text-amber-400">TEAM TITLE</h3>
                        </div>
                        <input type="text" id="teamTitle" onchange="updateTeamTitle(this.value)"
                               class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white"
                               placeholder="Team title...">
                    </div>

                    <!-- Bullet Points -->
                    <div class="bg-gray-700/50 rounded-xl p-6 border-l-4 border-amber-400">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">üìã</span>
                            <h3 class="text-base font-bold text-amber-400">BULLET POINTS</h3>
                        </div>
                        <div id="bulletPointItems" class="space-y-3">
                            <!-- Bullet point items will be loaded here -->
                        </div>
                        <button onclick="addItem('bulletPoints')" class="mt-3 text-amber-400 hover:text-amber-300 flex items-center gap-1.5 text-sm">
                            ‚ûï Add Bullet Point
                        </button>
                    </div>

                    <!-- Core Enablers -->
                    <div class="bg-gray-700/50 rounded-xl p-6 border-l-4 border-blue-400">
                        <div class="flex items-center gap-3 mb-4">
                            <span class="text-2xl">üîß</span>
                            <h3 class="text-base font-bold text-blue-400">CORE ENABLERS</h3>
                        </div>
                        <input type="text" id="enablersTitle" onchange="updateEnablersTitle(this.value)"
                               class="w-full bg-slate-700 border border-slate-600 rounded px-3 py-2 text-white mb-3"
                               placeholder="Enablers title...">
                        <div id="enablerItems" class="space-y-3">
                            <!-- Enabler items will be loaded here -->
                        </div>
                        <button onclick="addItem('enablers')" class="mt-3 text-blue-400 hover:text-blue-300 flex items-center gap-1.5 text-sm">
                            ‚ûï Add Enabler
                        </button>
                    </div>
                </div>
            </div>

            <!-- Instructions -->
            <div class="mt-8 p-6 bg-gray-800/30 rounded-xl">
                <h3 class="text-xl font-bold text-blue-400 mb-4">üìã How to Use</h3>
                <ol class="list-decimal list-inside space-y-2 text-gray-300">
                    <li>Enter your token and click "Load"</li>
                    <li>Edit text in any section below</li>
                    <li>Add new items with ‚ûï buttons</li>
                    <li>Click "Save & Push" to update</li>
                    <li>View changes on live site (5-10 minutes)</li>
                </ol>
            </div>
        </div>
    </div>

    <script>
        let currentContent = null;
        let savedToken = null;

        function showStatus(message, type = 'info') {
            const alert = document.getElementById('statusAlert');
            const messageEl = document.getElementById('statusMessage');
            messageEl.textContent = message;
            
            alert.classList.remove('hidden', 'bg-blue-500/10', 'border-blue-500/30', 'bg-green-500/10', 'border-green-500/30', 'bg-red-500/10', 'border-red-500/30');
            messageEl.classList.remove('text-blue-400', 'text-green-400', 'text-red-400');
            
            if (type === 'success') {
                alert.classList.add('bg-green-500/10', 'border-green-500/30');
                messageEl.classList.add('text-green-400');
            } else if (type === 'error') {
                alert.classList.add('bg-red-500/10', 'border-red-500/30');
                messageEl.classList.add('text-red-400');
            } else {
                alert.classList.add('bg-blue-500/10', 'border-blue-500/30');
                messageEl.classList.add('text-blue-400');
            }
            
            alert.classList.remove('hidden');
            
            setTimeout(() => {
                alert.classList.add('hidden');
            }, 5000);
        }

        function setTokenAndLoad() {
            const token = document.getElementById('githubToken').value.trim();
            if (!token) {
                showStatus('Please enter a token first!', 'error');
                return;
            }
            
            savedToken = token;
            localStorage.setItem('editorToken', token);
            
            // Hide token section, show content section
            document.getElementById('tokenSection').classList.add('hidden');
            document.getElementById('contentSection').classList.remove('hidden');
            
            loadContent();
        }
        
        function resetToken() {
            savedToken = null;
            localStorage.removeItem('editorToken');
            document.getElementById('githubToken').value = '';
            document.getElementById('tokenSection').classList.remove('hidden');
            document.getElementById('contentSection').classList.add('hidden');
            currentContent = null;
            
            // Clear editor content
            ['bulletPointItems', 'enablerItems'].forEach(id => {
                const element = document.getElementById(id);
                if (element) element.innerHTML = '';
            });
        }
        
        // Check for saved token on page load
        window.addEventListener('load', function() {
            const savedTokenFromStorage = localStorage.getItem('editorToken');
            if (savedTokenFromStorage) {
                savedToken = savedTokenFromStorage;
                document.getElementById('githubToken').value = savedTokenFromStorage;
                setTokenAndLoad();
            }
        });

        async function loadContent() {
            const token = savedToken || document.getElementById('githubToken').value;
            if (!token) {
                showStatus('Please enter your token first!', 'error');
                return;
            }

            showStatus('Loading content...');
            
            try {
                const response = await fetch('https://api.github.com/repos/Multinat/CrewArmy/contents/app/lib/slide-content.json', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                if (!response.ok) {
                    throw new Error(`API error: ${response.status}`);
                }

                const data = await response.json();
                const content = JSON.parse(atob(data.content));
                currentContent = content;

                // Populate the editor with content
                populateEditor(content.slide2);
                showStatus('‚úÖ Content loaded successfully!', 'success');
                
            } catch (error) {
                showStatus(`Error loading content: ${error.message}`, 'error');
            }
        }

        function populateEditor(slide2) {
            // Populate Page Title & Subtitle
            if (slide2.title) document.getElementById('pageTitle').value = slide2.title;
            if (slide2.subtitle) document.getElementById('pageSubtitle').value = slide2.subtitle;
            
            // Populate VPO Wheel
            if (slide2.vpoWheel) {
                document.getElementById('centerText').value = slide2.vpoWheel.centerText || '';
                document.getElementById('centerSubtext').value = slide2.vpoWheel.centerSubtext || '';
                document.getElementById('safetyTitle').value = slide2.vpoWheel.safety?.title || '';
                document.getElementById('safetySubtitle').value = slide2.vpoWheel.safety?.subtitle || '';
                document.getElementById('qualityTitle').value = slide2.vpoWheel.quality?.title || '';
                document.getElementById('qualitySubtitle').value = slide2.vpoWheel.quality?.subtitle || '';
                document.getElementById('volumeTitle').value = slide2.vpoWheel.volume?.title || '';
                document.getElementById('volumeSubtitle').value = slide2.vpoWheel.volume?.subtitle || '';
                document.getElementById('costTitle').value = slide2.vpoWheel.cost?.title || '';
                document.getElementById('costSubtitle').value = slide2.vpoWheel.cost?.subtitle || '';
            }
            
            // Populate Team Section
            if (slide2.autonomousTeam) {
                document.getElementById('teamTitle').value = slide2.autonomousTeam.title || '';
                document.getElementById('enablersTitle').value = slide2.autonomousTeam.coreEnablers?.title || '';
                
                populateSection('bulletPointItems', slide2.autonomousTeam.bulletPoints || [], 'bulletPoints');
                populateSection('enablerItems', slide2.autonomousTeam.coreEnablers?.items || [], 'enablers');
            }
        }

        function populateSection(containerId, items, section) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            items.forEach((item, index) => {
                const div = document.createElement('div');
                div.className = 'flex items-start gap-2';
                div.innerHTML = `
                    <div class="w-2 h-2 bg-current rounded-full mt-2 opacity-60"></div>
                    <textarea 
                           onchange="updateItem('${section}', ${index}, this.value)"
                           oninput="autoResize(this)"
                           class="flex-1 bg-slate-700 border border-slate-600 rounded px-2 py-1.5 text-white text-xs leading-tight resize-none overflow-hidden"
                           rows="1"
                           style="min-height: 24px; line-height: 1.2;"
                           placeholder="Enter item...">${item}</textarea>
                    <button onclick="removeItem('${section}', ${index})" 
                            class="text-red-400 hover:text-red-300 px-1.5 py-1 rounded text-xs"
                            title="Remove item">üóëÔ∏è</button>
                `;
                container.appendChild(div);
            });
        }

        function updatePageTitle(value) {
            if (!currentContent) return;
            currentContent.slide2.title = value;
        }

        function updatePageSubtitle(value) {
            if (!currentContent) return;
            currentContent.slide2.subtitle = value;
        }

        function updateVPOWheel(path, value) {
            if (!currentContent) return;
            const parts = path.split('.');
            if (parts.length === 1) {
                currentContent.slide2.vpoWheel[parts[0]] = value;
            } else {
                currentContent.slide2.vpoWheel[parts[0]][parts[1]] = value;
            }
        }

        function updateTeamTitle(value) {
            if (!currentContent) return;
            currentContent.slide2.autonomousTeam.title = value;
        }

        function updateEnablersTitle(value) {
            if (!currentContent) return;
            currentContent.slide2.autonomousTeam.coreEnablers.title = value;
        }

        function updateItem(section, index, value) {
            if (!currentContent) return;
            
            if (section === 'bulletPoints') {
                currentContent.slide2.autonomousTeam.bulletPoints[index] = value;
            } else if (section === 'enablers') {
                currentContent.slide2.autonomousTeam.coreEnablers.items[index] = value;
            }
        }

        function addItem(section) {
            if (!currentContent) {
                showStatus('Please load content first!', 'error');
                return;
            }
            
            if (section === 'bulletPoints') {
                currentContent.slide2.autonomousTeam.bulletPoints.push('New bullet point');
                populateSection('bulletPointItems', currentContent.slide2.autonomousTeam.bulletPoints, 'bulletPoints');
            } else if (section === 'enablers') {
                currentContent.slide2.autonomousTeam.coreEnablers.items.push('New enabler');
                populateSection('enablerItems', currentContent.slide2.autonomousTeam.coreEnablers.items, 'enablers');
            }
        }

        function removeItem(section, index) {
            if (!currentContent) return;
            
            if (section === 'bulletPoints') {
                currentContent.slide2.autonomousTeam.bulletPoints.splice(index, 1);
                populateSection('bulletPointItems', currentContent.slide2.autonomousTeam.bulletPoints, 'bulletPoints');
            } else if (section === 'enablers') {
                currentContent.slide2.autonomousTeam.coreEnablers.items.splice(index, 1);
                populateSection('enablerItems', currentContent.slide2.autonomousTeam.coreEnablers.items, 'enablers');
            }
        }

        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.max(24, textarea.scrollHeight) + 'px';
        }

        async function saveContent() {
            const token = savedToken || document.getElementById('githubToken').value;
            if (!token || !currentContent) {
                showStatus('Please enter token and load content first!', 'error');
                return;
            }

            showStatus('Saving and pushing changes...');

            try {
                // Get current file to get its SHA
                const getResponse = await fetch('https://api.github.com/repos/Multinat/CrewArmy/contents/app/lib/slide-content.json', {
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json'
                    }
                });

                const currentFile = await getResponse.json();
                
                // Update the file
                const updateResponse = await fetch('https://api.github.com/repos/Multinat/CrewArmy/contents/app/lib/slide-content.json', {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: `Update Page 2 content via static editor\n\n- Updated via static editor\n- Timestamp: ${new Date().toISOString()}`,
                        content: btoa(JSON.stringify(currentContent, null, 2)),
                        sha: currentFile.sha
                    })
                });

                if (updateResponse.ok) {
                    showStatus('‚úÖ Content saved and pushed successfully!', 'success');
                } else {
                    throw new Error(`Failed to update: ${updateResponse.status}`);
                }

            } catch (error) {
                showStatus(`Error saving: ${error.message}`, 'error');
            }
        }
    </script>
</body>
</html>
